{"version":3,"file":"static/js/996.356b5ec6.chunk.js","mappings":"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","sources":["../node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","../node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js","../node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js","../node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","../node_modules/@babel/runtime/helpers/esm/createClass.js","../node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/inherits.js","../node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","../node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","../node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../node_modules/@babel/runtime/helpers/esm/createSuper.js","../node_modules/@babel/runtime/helpers/esm/construct.js","../node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js","../node_modules/@babel/runtime/helpers/esm/isNativeFunction.js","../node_modules/livekit-client/node_modules/events/events.js","../node_modules/livekit-client/src/logger.ts","../node_modules/livekit-client/node_modules/loglevel/lib/loglevel.js","../node_modules/livekit-client/src/room/errors.ts","../node_modules/livekit-client/src/e2ee/constants.ts","../node_modules/livekit-client/src/room/track/options.ts","../node_modules/livekit-client/src/e2ee/errors.ts","../node_modules/livekit-client/src/e2ee/types.ts","../node_modules/livekit-client/src/e2ee/utils.ts","../node_modules/livekit-client/src/e2ee/worker/Cryptor.ts","../node_modules/livekit-client/src/e2ee/worker/e2ee.worker.ts","../node_modules/livekit-client/src/e2ee/worker/ParticipantKeyHandler.ts"],"sourcesContent":["export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (_i == null) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n\n  var _s, _e;\n\n  try {\n    for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nexport default function _createForOfIteratorHelper(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n\n  if (!it) {\n    if (Array.isArray(o) || (it = unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n      if (it) o = it;\n      var i = 0;\n\n      var F = function F() {};\n\n      return {\n        s: F,\n        n: function n() {\n          if (i >= o.length) return {\n            done: true\n          };\n          return {\n            done: false,\n            value: o[i++]\n          };\n        },\n        e: function e(_e) {\n          throw _e;\n        },\n        f: F\n      };\n    }\n\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n\n  var normalCompletion = true,\n      didErr = false,\n      err;\n  return {\n    s: function s() {\n      it = it.call(o);\n    },\n    n: function n() {\n      var step = it.next();\n      normalCompletion = step.done;\n      return step;\n    },\n    e: function e(_e2) {\n      didErr = true;\n      err = _e2;\n    },\n    f: function f() {\n      try {\n        if (!normalCompletion && it[\"return\"] != null) it[\"return\"]();\n      } finally {\n        if (didErr) throw err;\n      }\n    }\n  };\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import _typeof from \"./typeof.js\";\nexport default function _regeneratorRuntime() {\n  \"use strict\";\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */\n\n  _regeneratorRuntime = function _regeneratorRuntime() {\n    return exports;\n  };\n\n  var exports = {},\n      Op = Object.prototype,\n      hasOwn = Op.hasOwnProperty,\n      $Symbol = \"function\" == typeof Symbol ? Symbol : {},\n      iteratorSymbol = $Symbol.iterator || \"@@iterator\",\n      asyncIteratorSymbol = $Symbol.asyncIterator || \"@@asyncIterator\",\n      toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  function define(obj, key, value) {\n    return Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: !0,\n      configurable: !0,\n      writable: !0\n    }), obj[key];\n  }\n\n  try {\n    define({}, \"\");\n  } catch (err) {\n    define = function define(obj, key, value) {\n      return obj[key] = value;\n    };\n  }\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator,\n        generator = Object.create(protoGenerator.prototype),\n        context = new Context(tryLocsList || []);\n    return generator._invoke = function (innerFn, self, context) {\n      var state = \"suspendedStart\";\n      return function (method, arg) {\n        if (\"executing\" === state) throw new Error(\"Generator is already running\");\n\n        if (\"completed\" === state) {\n          if (\"throw\" === method) throw arg;\n          return doneResult();\n        }\n\n        for (context.method = method, context.arg = arg;;) {\n          var delegate = context.delegate;\n\n          if (delegate) {\n            var delegateResult = maybeInvokeDelegate(delegate, context);\n\n            if (delegateResult) {\n              if (delegateResult === ContinueSentinel) continue;\n              return delegateResult;\n            }\n          }\n\n          if (\"next\" === context.method) context.sent = context._sent = context.arg;else if (\"throw\" === context.method) {\n            if (\"suspendedStart\" === state) throw state = \"completed\", context.arg;\n            context.dispatchException(context.arg);\n          } else \"return\" === context.method && context.abrupt(\"return\", context.arg);\n          state = \"executing\";\n          var record = tryCatch(innerFn, self, context);\n\n          if (\"normal\" === record.type) {\n            if (state = context.done ? \"completed\" : \"suspendedYield\", record.arg === ContinueSentinel) continue;\n            return {\n              value: record.arg,\n              done: context.done\n            };\n          }\n\n          \"throw\" === record.type && (state = \"completed\", context.method = \"throw\", context.arg = record.arg);\n        }\n      };\n    }(innerFn, self, context), generator;\n  }\n\n  function tryCatch(fn, obj, arg) {\n    try {\n      return {\n        type: \"normal\",\n        arg: fn.call(obj, arg)\n      };\n    } catch (err) {\n      return {\n        type: \"throw\",\n        arg: err\n      };\n    }\n  }\n\n  exports.wrap = wrap;\n  var ContinueSentinel = {};\n\n  function Generator() {}\n\n  function GeneratorFunction() {}\n\n  function GeneratorFunctionPrototype() {}\n\n  var IteratorPrototype = {};\n  define(IteratorPrototype, iteratorSymbol, function () {\n    return this;\n  });\n  var getProto = Object.getPrototypeOf,\n      NativeIteratorPrototype = getProto && getProto(getProto(values([])));\n  NativeIteratorPrototype && NativeIteratorPrototype !== Op && hasOwn.call(NativeIteratorPrototype, iteratorSymbol) && (IteratorPrototype = NativeIteratorPrototype);\n  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(IteratorPrototype);\n\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function (method) {\n      define(prototype, method, function (arg) {\n        return this._invoke(method, arg);\n      });\n    });\n  }\n\n  function AsyncIterator(generator, PromiseImpl) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n\n      if (\"throw\" !== record.type) {\n        var result = record.arg,\n            value = result.value;\n        return value && \"object\" == _typeof(value) && hasOwn.call(value, \"__await\") ? PromiseImpl.resolve(value.__await).then(function (value) {\n          invoke(\"next\", value, resolve, reject);\n        }, function (err) {\n          invoke(\"throw\", err, resolve, reject);\n        }) : PromiseImpl.resolve(value).then(function (unwrapped) {\n          result.value = unwrapped, resolve(result);\n        }, function (error) {\n          return invoke(\"throw\", error, resolve, reject);\n        });\n      }\n\n      reject(record.arg);\n    }\n\n    var previousPromise;\n\n    this._invoke = function (method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new PromiseImpl(function (resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise = previousPromise ? previousPromise.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg();\n    };\n  }\n\n  function maybeInvokeDelegate(delegate, context) {\n    var method = delegate.iterator[context.method];\n\n    if (undefined === method) {\n      if (context.delegate = null, \"throw\" === context.method) {\n        if (delegate.iterator[\"return\"] && (context.method = \"return\", context.arg = undefined, maybeInvokeDelegate(delegate, context), \"throw\" === context.method)) return ContinueSentinel;\n        context.method = \"throw\", context.arg = new TypeError(\"The iterator does not provide a 'throw' method\");\n      }\n\n      return ContinueSentinel;\n    }\n\n    var record = tryCatch(method, delegate.iterator, context.arg);\n    if (\"throw\" === record.type) return context.method = \"throw\", context.arg = record.arg, context.delegate = null, ContinueSentinel;\n    var info = record.arg;\n    return info ? info.done ? (context[delegate.resultName] = info.value, context.next = delegate.nextLoc, \"return\" !== context.method && (context.method = \"next\", context.arg = undefined), context.delegate = null, ContinueSentinel) : info : (context.method = \"throw\", context.arg = new TypeError(\"iterator result is not an object\"), context.delegate = null, ContinueSentinel);\n  }\n\n  function pushTryEntry(locs) {\n    var entry = {\n      tryLoc: locs[0]\n    };\n    1 in locs && (entry.catchLoc = locs[1]), 2 in locs && (entry.finallyLoc = locs[2], entry.afterLoc = locs[3]), this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\", delete record.arg, entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    this.tryEntries = [{\n      tryLoc: \"root\"\n    }], tryLocsList.forEach(pushTryEntry, this), this.reset(!0);\n  }\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) return iteratorMethod.call(iterable);\n      if (\"function\" == typeof iterable.next) return iterable;\n\n      if (!isNaN(iterable.length)) {\n        var i = -1,\n            next = function next() {\n          for (; ++i < iterable.length;) {\n            if (hasOwn.call(iterable, i)) return next.value = iterable[i], next.done = !1, next;\n          }\n\n          return next.value = undefined, next.done = !0, next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    return {\n      next: doneResult\n    };\n  }\n\n  function doneResult() {\n    return {\n      value: undefined,\n      done: !0\n    };\n  }\n\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, define(Gp, \"constructor\", GeneratorFunctionPrototype), define(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, toStringTagSymbol, \"GeneratorFunction\"), exports.isGeneratorFunction = function (genFun) {\n    var ctor = \"function\" == typeof genFun && genFun.constructor;\n    return !!ctor && (ctor === GeneratorFunction || \"GeneratorFunction\" === (ctor.displayName || ctor.name));\n  }, exports.mark = function (genFun) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(genFun, GeneratorFunctionPrototype) : (genFun.__proto__ = GeneratorFunctionPrototype, define(genFun, toStringTagSymbol, \"GeneratorFunction\")), genFun.prototype = Object.create(Gp), genFun;\n  }, exports.awrap = function (arg) {\n    return {\n      __await: arg\n    };\n  }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, asyncIteratorSymbol, function () {\n    return this;\n  }), exports.AsyncIterator = AsyncIterator, exports.async = function (innerFn, outerFn, self, tryLocsList, PromiseImpl) {\n    void 0 === PromiseImpl && (PromiseImpl = Promise);\n    var iter = new AsyncIterator(wrap(innerFn, outerFn, self, tryLocsList), PromiseImpl);\n    return exports.isGeneratorFunction(outerFn) ? iter : iter.next().then(function (result) {\n      return result.done ? result.value : iter.next();\n    });\n  }, defineIteratorMethods(Gp), define(Gp, toStringTagSymbol, \"Generator\"), define(Gp, iteratorSymbol, function () {\n    return this;\n  }), define(Gp, \"toString\", function () {\n    return \"[object Generator]\";\n  }), exports.keys = function (object) {\n    var keys = [];\n\n    for (var key in object) {\n      keys.push(key);\n    }\n\n    return keys.reverse(), function next() {\n      for (; keys.length;) {\n        var key = keys.pop();\n        if (key in object) return next.value = key, next.done = !1, next;\n      }\n\n      return next.done = !0, next;\n    };\n  }, exports.values = values, Context.prototype = {\n    constructor: Context,\n    reset: function reset(skipTempReset) {\n      if (this.prev = 0, this.next = 0, this.sent = this._sent = undefined, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = undefined, this.tryEntries.forEach(resetTryEntry), !skipTempReset) for (var name in this) {\n        \"t\" === name.charAt(0) && hasOwn.call(this, name) && !isNaN(+name.slice(1)) && (this[name] = undefined);\n      }\n    },\n    stop: function stop() {\n      this.done = !0;\n      var rootRecord = this.tryEntries[0].completion;\n      if (\"throw\" === rootRecord.type) throw rootRecord.arg;\n      return this.rval;\n    },\n    dispatchException: function dispatchException(exception) {\n      if (this.done) throw exception;\n      var context = this;\n\n      function handle(loc, caught) {\n        return record.type = \"throw\", record.arg = exception, context.next = loc, caught && (context.method = \"next\", context.arg = undefined), !!caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i],\n            record = entry.completion;\n        if (\"root\" === entry.tryLoc) return handle(\"end\");\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\"),\n              hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);\n            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) return handle(entry.catchLoc, !0);\n          } else {\n            if (!hasFinally) throw new Error(\"try statement without catch or finally\");\n            if (this.prev < entry.finallyLoc) return handle(entry.finallyLoc);\n          }\n        }\n      }\n    },\n    abrupt: function abrupt(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n\n        if (entry.tryLoc <= this.prev && hasOwn.call(entry, \"finallyLoc\") && this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      finallyEntry && (\"break\" === type || \"continue\" === type) && finallyEntry.tryLoc <= arg && arg <= finallyEntry.finallyLoc && (finallyEntry = null);\n      var record = finallyEntry ? finallyEntry.completion : {};\n      return record.type = type, record.arg = arg, finallyEntry ? (this.method = \"next\", this.next = finallyEntry.finallyLoc, ContinueSentinel) : this.complete(record);\n    },\n    complete: function complete(record, afterLoc) {\n      if (\"throw\" === record.type) throw record.arg;\n      return \"break\" === record.type || \"continue\" === record.type ? this.next = record.arg : \"return\" === record.type ? (this.rval = this.arg = record.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === record.type && afterLoc && (this.next = afterLoc), ContinueSentinel;\n    },\n    finish: function finish(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) return this.complete(entry.completion, entry.afterLoc), resetTryEntry(entry), ContinueSentinel;\n      }\n    },\n    \"catch\": function _catch(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n\n          if (\"throw\" === record.type) {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n\n          return thrown;\n        }\n      }\n\n      throw new Error(\"illegal catch attempt\");\n    },\n    delegateYield: function delegateYield(iterable, resultName, nextLoc) {\n      return this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      }, \"next\" === this.method && (this.arg = undefined), ContinueSentinel;\n    }\n  }, exports;\n}","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}","export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","import _typeof from \"./typeof.js\";\nimport assertThisInitialized from \"./assertThisInitialized.js\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return assertThisInitialized(self);\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","import getPrototypeOf from \"./getPrototypeOf.js\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct.js\";\nimport possibleConstructorReturn from \"./possibleConstructorReturn.js\";\nexport default function _createSuper(Derived) {\n  var hasNativeReflectConstruct = isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return possibleConstructorReturn(this, result);\n  };\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct.js\";\nexport default function _construct(Parent, args, Class) {\n  if (isNativeReflectConstruct()) {\n    _construct = Reflect.construct.bind();\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}","import getPrototypeOf from \"./getPrototypeOf.js\";\nimport setPrototypeOf from \"./setPrototypeOf.js\";\nimport isNativeFunction from \"./isNativeFunction.js\";\nimport construct from \"./construct.js\";\nexport default function _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return construct(Class, arguments, getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}","export default function _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","import * as log from 'loglevel';\n\nexport enum LogLevel {\n  trace = 0,\n  debug = 1,\n  info = 2,\n  warn = 3,\n  error = 4,\n  silent = 5,\n}\n\ntype LogLevelString = keyof typeof LogLevel;\n\ntype StructuredLogger = {\n  trace: (msg: string, context?: object) => void;\n  debug: (msg: string, context?: object) => void;\n  info: (msg: string, context?: object) => void;\n  warn: (msg: string, context?: object) => void;\n  error: (msg: string, context?: object) => void;\n};\n\nconst livekitLogger = log.getLogger('livekit');\n\nlivekitLogger.setLevel(LogLevel.info);\n\nexport default livekitLogger as StructuredLogger;\n\nexport function setLogLevel(level: LogLevel | LogLevelString, loggerName?: 'livekit' | 'lk-e2ee') {\n  if (loggerName) {\n    log.getLogger(loggerName).setLevel(level);\n  }\n  for (const logger of Object.values(log.getLoggers())) {\n    logger.setLevel(level);\n  }\n}\n\nexport type LogExtension = (level: LogLevel, msg: string, context?: object) => void;\n\n/**\n * use this to hook into the logging function to allow sending internal livekit logs to third party services\n * if set, the browser logs will lose their stacktrace information (see https://github.com/pimterry/loglevel#writing-plugins)\n */\nexport function setLogExtension(extension: LogExtension) {\n  const originalFactory = livekitLogger.methodFactory;\n\n  livekitLogger.methodFactory = (methodName, logLevel, loggerName) => {\n    const rawMethod = originalFactory(methodName, logLevel, loggerName);\n\n    const configLevel = livekitLogger.getLevel();\n    const needLog = logLevel >= configLevel && logLevel < LogLevel.silent;\n\n    return (msg, context?: [msg: string, context: object]) => {\n      if (context) rawMethod(msg, context);\n      else rawMethod(msg);\n      if (needLog) {\n        extension(logLevel, msg, context);\n      }\n    };\n  };\n  livekitLogger.setLevel(livekitLogger.getLevel()); // Be sure to call setLevel method in order to apply plugin\n}\n\nexport const workerLogger = log.getLogger('lk-e2ee') as StructuredLogger;\n","/*\n* loglevel - https://github.com/pimterry/loglevel\n*\n* Copyright (c) 2013 Tim Perry\n* Licensed under the MIT license.\n*/\n(function (root, definition) {\n    \"use strict\";\n    if (typeof define === 'function' && define.amd) {\n        define(definition);\n    } else if (typeof module === 'object' && module.exports) {\n        module.exports = definition();\n    } else {\n        root.log = definition();\n    }\n}(this, function () {\n    \"use strict\";\n\n    // Slightly dubious tricks to cut down minimized file size\n    var noop = function() {};\n    var undefinedType = \"undefined\";\n    var isIE = (typeof window !== undefinedType) && (typeof window.navigator !== undefinedType) && (\n        /Trident\\/|MSIE /.test(window.navigator.userAgent)\n    );\n\n    var logMethods = [\n        \"trace\",\n        \"debug\",\n        \"info\",\n        \"warn\",\n        \"error\"\n    ];\n\n    // Cross-browser bind equivalent that works at least back to IE6\n    function bindMethod(obj, methodName) {\n        var method = obj[methodName];\n        if (typeof method.bind === 'function') {\n            return method.bind(obj);\n        } else {\n            try {\n                return Function.prototype.bind.call(method, obj);\n            } catch (e) {\n                // Missing bind shim or IE8 + Modernizr, fallback to wrapping\n                return function() {\n                    return Function.prototype.apply.apply(method, [obj, arguments]);\n                };\n            }\n        }\n    }\n\n    // Trace() doesn't print the message in IE, so for that case we need to wrap it\n    function traceForIE() {\n        if (console.log) {\n            if (console.log.apply) {\n                console.log.apply(console, arguments);\n            } else {\n                // In old IE, native console methods themselves don't have apply().\n                Function.prototype.apply.apply(console.log, [console, arguments]);\n            }\n        }\n        if (console.trace) console.trace();\n    }\n\n    // Build the best logging method possible for this env\n    // Wherever possible we want to bind, not wrap, to preserve stack traces\n    function realMethod(methodName) {\n        if (methodName === 'debug') {\n            methodName = 'log';\n        }\n\n        if (typeof console === undefinedType) {\n            return false; // No method possible, for now - fixed later by enableLoggingWhenConsoleArrives\n        } else if (methodName === 'trace' && isIE) {\n            return traceForIE;\n        } else if (console[methodName] !== undefined) {\n            return bindMethod(console, methodName);\n        } else if (console.log !== undefined) {\n            return bindMethod(console, 'log');\n        } else {\n            return noop;\n        }\n    }\n\n    // These private functions always need `this` to be set properly\n\n    function replaceLoggingMethods(level, loggerName) {\n        /*jshint validthis:true */\n        for (var i = 0; i < logMethods.length; i++) {\n            var methodName = logMethods[i];\n            this[methodName] = (i < level) ?\n                noop :\n                this.methodFactory(methodName, level, loggerName);\n        }\n\n        // Define log.log as an alias for log.debug\n        this.log = this.debug;\n    }\n\n    // In old IE versions, the console isn't present until you first open it.\n    // We build realMethod() replacements here that regenerate logging methods\n    function enableLoggingWhenConsoleArrives(methodName, level, loggerName) {\n        return function () {\n            if (typeof console !== undefinedType) {\n                replaceLoggingMethods.call(this, level, loggerName);\n                this[methodName].apply(this, arguments);\n            }\n        };\n    }\n\n    // By default, we use closely bound real methods wherever possible, and\n    // otherwise we wait for a console to appear, and then try again.\n    function defaultMethodFactory(methodName, level, loggerName) {\n        /*jshint validthis:true */\n        return realMethod(methodName) ||\n               enableLoggingWhenConsoleArrives.apply(this, arguments);\n    }\n\n    function Logger(name, defaultLevel, factory) {\n      var self = this;\n      var currentLevel;\n      defaultLevel = defaultLevel == null ? \"WARN\" : defaultLevel;\n\n      var storageKey = \"loglevel\";\n      if (typeof name === \"string\") {\n        storageKey += \":\" + name;\n      } else if (typeof name === \"symbol\") {\n        storageKey = undefined;\n      }\n\n      function persistLevelIfPossible(levelNum) {\n          var levelName = (logMethods[levelNum] || 'silent').toUpperCase();\n\n          if (typeof window === undefinedType || !storageKey) return;\n\n          // Use localStorage if available\n          try {\n              window.localStorage[storageKey] = levelName;\n              return;\n          } catch (ignore) {}\n\n          // Use session cookie as fallback\n          try {\n              window.document.cookie =\n                encodeURIComponent(storageKey) + \"=\" + levelName + \";\";\n          } catch (ignore) {}\n      }\n\n      function getPersistedLevel() {\n          var storedLevel;\n\n          if (typeof window === undefinedType || !storageKey) return;\n\n          try {\n              storedLevel = window.localStorage[storageKey];\n          } catch (ignore) {}\n\n          // Fallback to cookies if local storage gives us nothing\n          if (typeof storedLevel === undefinedType) {\n              try {\n                  var cookie = window.document.cookie;\n                  var location = cookie.indexOf(\n                      encodeURIComponent(storageKey) + \"=\");\n                  if (location !== -1) {\n                      storedLevel = /^([^;]+)/.exec(cookie.slice(location))[1];\n                  }\n              } catch (ignore) {}\n          }\n\n          // If the stored level is not valid, treat it as if nothing was stored.\n          if (self.levels[storedLevel] === undefined) {\n              storedLevel = undefined;\n          }\n\n          return storedLevel;\n      }\n\n      function clearPersistedLevel() {\n          if (typeof window === undefinedType || !storageKey) return;\n\n          // Use localStorage if available\n          try {\n              window.localStorage.removeItem(storageKey);\n              return;\n          } catch (ignore) {}\n\n          // Use session cookie as fallback\n          try {\n              window.document.cookie =\n                encodeURIComponent(storageKey) + \"=; expires=Thu, 01 Jan 1970 00:00:00 UTC\";\n          } catch (ignore) {}\n      }\n\n      /*\n       *\n       * Public logger API - see https://github.com/pimterry/loglevel for details\n       *\n       */\n\n      self.name = name;\n\n      self.levels = { \"TRACE\": 0, \"DEBUG\": 1, \"INFO\": 2, \"WARN\": 3,\n          \"ERROR\": 4, \"SILENT\": 5};\n\n      self.methodFactory = factory || defaultMethodFactory;\n\n      self.getLevel = function () {\n          return currentLevel;\n      };\n\n      self.setLevel = function (level, persist) {\n          if (typeof level === \"string\" && self.levels[level.toUpperCase()] !== undefined) {\n              level = self.levels[level.toUpperCase()];\n          }\n          if (typeof level === \"number\" && level >= 0 && level <= self.levels.SILENT) {\n              currentLevel = level;\n              if (persist !== false) {  // defaults to true\n                  persistLevelIfPossible(level);\n              }\n              replaceLoggingMethods.call(self, level, name);\n              if (typeof console === undefinedType && level < self.levels.SILENT) {\n                  return \"No console available for logging\";\n              }\n          } else {\n              throw \"log.setLevel() called with invalid level: \" + level;\n          }\n      };\n\n      self.setDefaultLevel = function (level) {\n          defaultLevel = level;\n          if (!getPersistedLevel()) {\n              self.setLevel(level, false);\n          }\n      };\n\n      self.resetLevel = function () {\n          self.setLevel(defaultLevel, false);\n          clearPersistedLevel();\n      };\n\n      self.enableAll = function(persist) {\n          self.setLevel(self.levels.TRACE, persist);\n      };\n\n      self.disableAll = function(persist) {\n          self.setLevel(self.levels.SILENT, persist);\n      };\n\n      // Initialize with the right level\n      var initialLevel = getPersistedLevel();\n      if (initialLevel == null) {\n          initialLevel = defaultLevel;\n      }\n      self.setLevel(initialLevel, false);\n    }\n\n    /*\n     *\n     * Top-level API\n     *\n     */\n\n    var defaultLogger = new Logger();\n\n    var _loggersByName = {};\n    defaultLogger.getLogger = function getLogger(name) {\n        if ((typeof name !== \"symbol\" && typeof name !== \"string\") || name === \"\") {\n          throw new TypeError(\"You must supply a name when creating a logger.\");\n        }\n\n        var logger = _loggersByName[name];\n        if (!logger) {\n          logger = _loggersByName[name] = new Logger(\n            name, defaultLogger.getLevel(), defaultLogger.methodFactory);\n        }\n        return logger;\n    };\n\n    // Grab the current global log variable in case of overwrite\n    var _log = (typeof window !== undefinedType) ? window.log : undefined;\n    defaultLogger.noConflict = function() {\n        if (typeof window !== undefinedType &&\n               window.log === defaultLogger) {\n            window.log = _log;\n        }\n\n        return defaultLogger;\n    };\n\n    defaultLogger.getLoggers = function getLoggers() {\n        return _loggersByName;\n    };\n\n    // ES6 default export, for compatibility\n    defaultLogger['default'] = defaultLogger;\n\n    return defaultLogger;\n}));\n","export class LivekitError extends Error {\n  code: number;\n\n  constructor(code: number, message?: string) {\n    super(message || 'an error has occured');\n    this.code = code;\n  }\n}\n\nexport const enum ConnectionErrorReason {\n  NotAllowed,\n  ServerUnreachable,\n  InternalError,\n}\n\nexport class ConnectionError extends LivekitError {\n  status?: number;\n\n  reason?: ConnectionErrorReason;\n\n  constructor(message?: string, reason?: ConnectionErrorReason, status?: number) {\n    super(1, message);\n    this.status = status;\n    this.reason = reason;\n  }\n}\n\nexport class TrackInvalidError extends LivekitError {\n  constructor(message?: string) {\n    super(20, message ?? 'track is invalid');\n  }\n}\n\nexport class UnsupportedServer extends LivekitError {\n  constructor(message?: string) {\n    super(10, message ?? 'unsupported server');\n  }\n}\n\nexport class UnexpectedConnectionState extends LivekitError {\n  constructor(message?: string) {\n    super(12, message ?? 'unexpected connection state');\n  }\n}\n\nexport class NegotiationError extends LivekitError {\n  constructor(message?: string) {\n    super(13, message ?? 'unable to negotiate');\n  }\n}\n\nexport class PublishDataError extends LivekitError {\n  constructor(message?: string) {\n    super(13, message ?? 'unable to publish data');\n  }\n}\n\nexport enum MediaDeviceFailure {\n  // user rejected permissions\n  PermissionDenied = 'PermissionDenied',\n  // device is not available\n  NotFound = 'NotFound',\n  // device is in use. On Windows, only a single tab may get access to a device at a time.\n  DeviceInUse = 'DeviceInUse',\n  Other = 'Other',\n}\n\nexport namespace MediaDeviceFailure {\n  export function getFailure(error: any): MediaDeviceFailure | undefined {\n    if (error && 'name' in error) {\n      if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {\n        return MediaDeviceFailure.NotFound;\n      }\n      if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {\n        return MediaDeviceFailure.PermissionDenied;\n      }\n      if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {\n        return MediaDeviceFailure.DeviceInUse;\n      }\n      return MediaDeviceFailure.Other;\n    }\n  }\n}\n","import type { KeyProviderOptions } from './types';\n\nexport const ENCRYPTION_ALGORITHM = 'AES-GCM';\n\n// We use a ringbuffer of keys so we can change them and still decode packets that were\n// encrypted with an old key. We use a size of 16 which corresponds to the four bits\n// in the frame trailer.\nexport const KEYRING_SIZE = 16;\n\n// We copy the first bytes of the VP8 payload unencrypted.\n// For keyframes this is 10 bytes, for non-keyframes (delta) 3. See\n//   https://tools.ietf.org/html/rfc6386#section-9.1\n// This allows the bridge to continue detecting keyframes (only one byte needed in the JVB)\n// and is also a bit easier for the VP8 decoder (i.e. it generates funny garbage pictures\n// instead of being unable to decode).\n// This is a bit for show and we might want to reduce to 1 unconditionally in the final version.\n//\n// For audio (where frame.type is not set) we do not encrypt the opus TOC byte:\n//   https://tools.ietf.org/html/rfc6716#section-3.1\nexport const UNENCRYPTED_BYTES = {\n  key: 10,\n  delta: 3,\n  audio: 1, // frame.type is not set on audio, so this is set manually\n  empty: 0,\n} as const;\n\n/* We use a 12 byte bit IV. This is signalled in plain together with the\n packet. See https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/encrypt#parameters */\nexport const IV_LENGTH = 12;\n\n// flag set to indicate that e2ee has been setup for sender/receiver;\nexport const E2EE_FLAG = 'lk_e2ee';\n\nexport const SALT = 'LKFrameEncryptionKey';\n\nexport const KEY_PROVIDER_DEFAULTS: KeyProviderOptions = {\n  sharedKey: false,\n  ratchetSalt: SALT,\n  ratchetWindowSize: 8,\n} as const;\n","import type { Track } from './Track';\n\nexport interface TrackPublishDefaults {\n  /**\n   * encoding parameters for camera track\n   */\n  videoEncoding?: VideoEncoding;\n\n  /**\n   * @experimental\n   */\n  backupCodec?: { codec: BackupVideoCodec; encoding: VideoEncoding } | false;\n\n  /**\n   * encoding parameters for screen share track\n   */\n  screenShareEncoding?: VideoEncoding;\n\n  /**\n   * codec, defaults to vp8; for svc codecs, auto enable vp8\n   * as backup. (TBD)\n   */\n  videoCodec?: VideoCodec;\n\n  /**\n   * max audio bitrate, defaults to [[AudioPresets.speech]]\n   */\n  audioBitrate?: number;\n\n  /**\n   * dtx (Discontinuous Transmission of audio), defaults to true\n   */\n  dtx?: boolean;\n\n  /**\n   * red (Redundant Audio Data), defaults to true\n   */\n  red?: boolean;\n\n  /**\n   * stereo audio track. defaults determined by capture channel count.\n   */\n  forceStereo?: boolean;\n\n  /**\n   * use simulcast, defaults to true.\n   * When using simulcast, LiveKit will publish up to three versions of the stream\n   * at various resolutions.\n   */\n  simulcast?: boolean;\n\n  /**\n   * scalability mode for svc codecs, defaults to 'L3T3'.\n   * for svc codecs, simulcast is disabled.\n   */\n  scalabilityMode?: ScalabilityMode;\n\n  /**\n   * custom video simulcast layers for camera tracks, defaults to h180, h360, h540\n   * You can specify up to two custom layers that will be used instead of\n   * the LiveKit default layers.\n   * Note: the layers need to be ordered from lowest to highest quality\n   */\n  videoSimulcastLayers?: Array<VideoPreset>;\n\n  /**\n   * custom video simulcast layers for screen tracks\n   * Note: the layers need to be ordered from lowest to highest quality\n   */\n  screenShareSimulcastLayers?: Array<VideoPreset>;\n\n  /**\n   * For local tracks, stop the underlying MediaStreamTrack when the track is muted (or paused)\n   * on some platforms, this option is necessary to disable the microphone recording indicator.\n   * Note: when this is enabled, and BT devices are connected, they will transition between\n   * profiles (e.g. HFP to A2DP) and there will be an audible difference in playback.\n   *\n   * defaults to false\n   */\n  stopMicTrackOnMute?: boolean;\n}\n\n/**\n * Options when publishing tracks\n */\nexport interface TrackPublishOptions extends TrackPublishDefaults {\n  /**\n   * set a track name\n   */\n  name?: string;\n\n  /**\n   * Source of track, camera, microphone, or screen\n   */\n  source?: Track.Source;\n}\n\nexport interface CreateLocalTracksOptions {\n  /**\n   * audio track options, true to create with defaults. false if audio shouldn't be created\n   * default true\n   */\n  audio?: boolean | AudioCaptureOptions;\n\n  /**\n   * video track options, true to create with defaults. false if video shouldn't be created\n   * default true\n   */\n  video?: boolean | VideoCaptureOptions;\n}\n\nexport interface VideoCaptureOptions {\n  /**\n   * A ConstrainDOMString object specifying a device ID or an array of device\n   * IDs which are acceptable and/or required.\n   */\n  deviceId?: ConstrainDOMString;\n\n  /**\n   * a facing or an array of facings which are acceptable and/or required.\n   */\n  facingMode?: 'user' | 'environment' | 'left' | 'right';\n\n  resolution?: VideoResolution;\n}\n\nexport interface ScreenShareCaptureOptions {\n  /**\n   * true to capture audio shared. browser support for audio capturing in\n   * screenshare is limited: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getDisplayMedia#browser_compatibility\n   */\n  audio?: boolean | AudioCaptureOptions;\n\n  /** capture resolution, defaults to full HD */\n  resolution?: VideoResolution;\n}\n\nexport interface AudioCaptureOptions {\n  /**\n   * specifies whether automatic gain control is preferred and/or required\n   */\n  autoGainControl?: ConstrainBoolean;\n\n  /**\n   * the channel count or range of channel counts which are acceptable and/or required\n   */\n  channelCount?: ConstrainULong;\n\n  /**\n   * A ConstrainDOMString object specifying a device ID or an array of device\n   * IDs which are acceptable and/or required.\n   */\n  deviceId?: ConstrainDOMString;\n\n  /**\n   * whether or not echo cancellation is preferred and/or required\n   */\n  echoCancellation?: ConstrainBoolean;\n\n  /**\n   * the latency or range of latencies which are acceptable and/or required.\n   */\n  latency?: ConstrainDouble;\n\n  /**\n   * whether noise suppression is preferred and/or required.\n   */\n  noiseSuppression?: ConstrainBoolean;\n\n  /**\n   * the sample rate or range of sample rates which are acceptable and/or required.\n   */\n  sampleRate?: ConstrainULong;\n\n  /**\n   * sample size or range of sample sizes which are acceptable and/or required.\n   */\n  sampleSize?: ConstrainULong;\n}\n\nexport interface AudioOutputOptions {\n  /**\n   * deviceId to output audio\n   *\n   * Only supported on browsers where `setSinkId` is available\n   */\n  deviceId?: string;\n}\n\nexport interface VideoResolution {\n  width: number;\n  height: number;\n  frameRate?: number;\n  aspectRatio?: number;\n}\n\nexport interface VideoEncoding {\n  maxBitrate: number;\n  maxFramerate?: number;\n}\n\nexport class VideoPreset {\n  encoding: VideoEncoding;\n\n  width: number;\n\n  height: number;\n\n  constructor(width: number, height: number, maxBitrate: number, maxFramerate?: number) {\n    this.width = width;\n    this.height = height;\n    this.encoding = {\n      maxBitrate,\n      maxFramerate,\n    };\n  }\n\n  get resolution(): VideoResolution {\n    return {\n      width: this.width,\n      height: this.height,\n      frameRate: this.encoding.maxFramerate,\n      aspectRatio: this.width / this.height,\n    };\n  }\n}\n\nexport interface AudioPreset {\n  maxBitrate: number;\n}\n\nexport const videoCodecs = ['vp8', 'h264', 'av1'] as const;\nconst backupCodecs = ['vp8', 'h264'] as const;\n\nexport type VideoCodec = typeof videoCodecs[number];\n\nexport type BackupVideoCodec = typeof backupCodecs[number];\n\nexport function isBackupCodec(codec: string): codec is BackupVideoCodec {\n  return !!backupCodecs.find((backup) => backup === codec);\n}\n\n/**\n * scalability modes for svc, only supprot l3t3 now.\n */\nexport type ScalabilityMode = 'L3T3';\n\nexport namespace AudioPresets {\n  export const telephone: AudioPreset = {\n    maxBitrate: 12_000,\n  };\n  export const speech: AudioPreset = {\n    maxBitrate: 20_000,\n  };\n  export const music: AudioPreset = {\n    maxBitrate: 32_000,\n  };\n  export const musicStereo: AudioPreset = {\n    maxBitrate: 48_000,\n  };\n  export const musicHighQuality: AudioPreset = {\n    maxBitrate: 64_000,\n  };\n  export const musicHighQualityStereo: AudioPreset = {\n    maxBitrate: 96_000,\n  };\n}\n\n/**\n * Sane presets for video resolution/encoding\n */\nexport const VideoPresets = {\n  h90: new VideoPreset(160, 90, 60_000, 15),\n  h180: new VideoPreset(320, 180, 120_000, 15),\n  h216: new VideoPreset(384, 216, 180_000, 15),\n  h360: new VideoPreset(640, 360, 300_000, 20),\n  h540: new VideoPreset(960, 540, 600_000, 25),\n  h720: new VideoPreset(1280, 720, 1_700_000, 30),\n  h1080: new VideoPreset(1920, 1080, 3_000_000, 30),\n  h1440: new VideoPreset(2560, 1440, 5_000_000, 30),\n  h2160: new VideoPreset(3840, 2160, 8_000_000, 30),\n} as const;\n\n/**\n * Four by three presets\n */\nexport const VideoPresets43 = {\n  h120: new VideoPreset(160, 120, 80_000, 15),\n  h180: new VideoPreset(240, 180, 100_000, 15),\n  h240: new VideoPreset(320, 240, 150_000, 15),\n  h360: new VideoPreset(480, 360, 225_000, 20),\n  h480: new VideoPreset(640, 480, 300_000, 20),\n  h540: new VideoPreset(720, 540, 450_000, 25),\n  h720: new VideoPreset(960, 720, 1_500_000, 30),\n  h1080: new VideoPreset(1440, 1080, 2_500_000, 30),\n  h1440: new VideoPreset(1920, 1440, 3_500_000, 30),\n} as const;\n\nexport const ScreenSharePresets = {\n  h360fps3: new VideoPreset(640, 360, 200_000, 3),\n  h720fps5: new VideoPreset(1280, 720, 400_000, 5),\n  h720fps15: new VideoPreset(1280, 720, 1_000_000, 15),\n  h1080fps15: new VideoPreset(1920, 1080, 1_500_000, 15),\n  h1080fps30: new VideoPreset(1920, 1080, 3_000_000, 30),\n} as const;\n","import { LivekitError } from '../room/errors';\n\nexport const enum E2EEErrorReason {\n  BrowserUnsupported,\n  InvalidKey,\n  MissingKey,\n  InternalError,\n  WorkerError,\n}\n\nexport class E2EEError extends LivekitError {\n  reason: E2EEErrorReason;\n\n  constructor(message?: string, reason: E2EEErrorReason = E2EEErrorReason.InternalError) {\n    super(40, message);\n    this.reason = reason;\n  }\n}\n","import type Participant from '../room/participant/Participant';\nimport type { VideoCodec } from '../room/track/options';\nimport type { E2EEError } from './errors';\nimport type { BaseKeyProvider } from './KeyProvider';\n\nexport interface BaseMessage {\n  kind: string;\n  data?: unknown;\n}\n\nexport interface InitMessage extends BaseMessage {\n  kind: 'init';\n  data: {\n    keyProviderOptions: KeyProviderOptions;\n  };\n}\n\nexport interface SetKeyMessage extends BaseMessage {\n  kind: 'setKey';\n  data: {\n    participantId?: string;\n    key: CryptoKey;\n    keyIndex?: number;\n  };\n}\n\nexport interface RTPVideoMapMessage extends BaseMessage {\n  kind: 'setRTPMap';\n  data: {\n    map: Map<number, VideoCodec>;\n  };\n}\n\nexport interface EncodeMessage extends BaseMessage {\n  kind: 'decode' | 'encode';\n  data: {\n    participantId: string;\n    readableStream: ReadableStream;\n    writableStream: WritableStream;\n    trackId: string;\n    codec?: VideoCodec;\n  };\n}\n\nexport interface RemoveTransformMessage extends BaseMessage {\n  kind: 'removeTransform';\n  data: {\n    participantId: string;\n    trackId: string;\n  };\n}\n\nexport interface UpdateCodecMessage extends BaseMessage {\n  kind: 'updateCodec';\n  data: {\n    participantId: string;\n    trackId: string;\n    codec: VideoCodec;\n  };\n}\n\nexport interface RatchetRequestMessage extends BaseMessage {\n  kind: 'ratchetRequest';\n  data: {\n    participantId: string | undefined;\n    keyIndex?: number;\n  };\n}\n\nexport interface RatchetMessage extends BaseMessage {\n  kind: 'ratchetKey';\n  data: {\n    // participantId: string | undefined;\n    keyIndex?: number;\n    material: CryptoKey;\n  };\n}\n\nexport interface ErrorMessage extends BaseMessage {\n  kind: 'error';\n  data: {\n    error: E2EEError;\n  };\n}\n\nexport interface EnableMessage extends BaseMessage {\n  kind: 'enable';\n  data: {\n    // if no participant id is set it indicates publisher encryption enable/disable\n    participantId?: string;\n    enabled: boolean;\n  };\n}\n\nexport type E2EEWorkerMessage =\n  | InitMessage\n  | SetKeyMessage\n  | EncodeMessage\n  | ErrorMessage\n  | EnableMessage\n  | RemoveTransformMessage\n  | RTPVideoMapMessage\n  | UpdateCodecMessage\n  | RatchetRequestMessage\n  | RatchetMessage;\n\nexport type KeySet = { material: CryptoKey; encryptionKey: CryptoKey };\n\nexport type KeyProviderOptions = {\n  sharedKey: boolean;\n  ratchetSalt: string;\n  ratchetWindowSize: number;\n};\n\nexport type KeyProviderCallbacks = {\n  setKey: (keyInfo: KeyInfo) => void;\n  ratchetRequest: (participantId?: string, keyIndex?: number) => void;\n  /** currently only emitted for local participant */\n  keyRatcheted: (material: CryptoKey, keyIndex?: number) => void;\n};\n\nexport type ParticipantKeyHandlerCallbacks = {\n  keyRatcheted: (material: CryptoKey, keyIndex?: number, participantId?: string) => void;\n};\n\nexport type E2EEManagerCallbacks = {\n  participantEncryptionStatusChanged: (enabled: boolean, participant?: Participant) => void;\n  encryptionError: (error: E2EEError) => void;\n};\n\nexport const EncryptionEvent = {\n  ParticipantEncryptionStatusChanged: 'participantEncryptionStatusChanged',\n  Error: 'encryptionError',\n} as const;\n\nexport type CryptorCallbacks = {\n  cryptorError: (error: E2EEError) => void;\n};\n\nexport const CryptorEvent = {\n  Error: 'cryptorError',\n} as const;\n\nexport type KeyInfo = {\n  key: CryptoKey;\n  participantId?: string;\n  keyIndex?: number;\n};\n\nexport type E2EEOptions = {\n  keyProvider: BaseKeyProvider;\n  worker: Worker;\n};\n\nexport type DecodeRatchetOptions = {\n  /** attempts  */\n  ratchetCount: number;\n  /** ratcheted key to try */\n  encryptionKey?: CryptoKey;\n};\n","import { videoCodecs } from '../room/track/options';\nimport type { VideoCodec } from '../room/track/options';\nimport { ENCRYPTION_ALGORITHM } from './constants';\n\nexport function isE2EESupported() {\n  return isInsertableStreamSupported() || isScriptTransformSupported();\n}\n\nexport function isScriptTransformSupported() {\n  // @ts-ignore\n  return typeof window.RTCRtpScriptTransform !== 'undefined';\n}\n\nexport function isInsertableStreamSupported() {\n  return (\n    typeof window.RTCRtpSender !== 'undefined' &&\n    // @ts-ignore\n    typeof window.RTCRtpSender.prototype.createEncodedStreams !== 'undefined'\n  );\n}\n\nexport function isVideoFrame(\n  frame: RTCEncodedAudioFrame | RTCEncodedVideoFrame,\n): frame is RTCEncodedVideoFrame {\n  return 'type' in frame;\n}\n\nexport async function importKey(\n  keyBytes: Uint8Array | ArrayBuffer,\n  algorithm: string | { name: string } = { name: ENCRYPTION_ALGORITHM },\n  usage: 'derive' | 'encrypt' = 'encrypt',\n) {\n  // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/importKey\n  return crypto.subtle.importKey(\n    'raw',\n    keyBytes,\n    algorithm,\n    false,\n    usage === 'derive' ? ['deriveBits', 'deriveKey'] : ['encrypt', 'decrypt'],\n  );\n}\n\nexport async function createKeyMaterialFromString(password: string) {\n  let enc = new TextEncoder();\n\n  const keyMaterial = await crypto.subtle.importKey(\n    'raw',\n    enc.encode(password),\n    {\n      name: 'PBKDF2',\n    },\n    false,\n    ['deriveBits', 'deriveKey'],\n  );\n\n  return keyMaterial;\n}\n\nfunction getAlgoOptions(algorithmName: string, salt: string) {\n  const textEncoder = new TextEncoder();\n  const encodedSalt = textEncoder.encode(salt);\n  switch (algorithmName) {\n    case 'HKDF':\n      return {\n        name: 'HKDF',\n        salt: encodedSalt,\n        hash: 'SHA-256',\n        info: new ArrayBuffer(128),\n      };\n    case 'PBKDF2': {\n      return {\n        name: 'PBKDF2',\n        salt: encodedSalt,\n        hash: 'SHA-256',\n        iterations: 100000,\n      };\n    }\n    default:\n      throw new Error(`algorithm ${algorithmName} is currently unsupported`);\n  }\n}\n\n/**\n * Derives a set of keys from the master key.\n * See https://tools.ietf.org/html/draft-omara-sframe-00#section-4.3.1\n */\nexport async function deriveKeys(material: CryptoKey, salt: string) {\n  const algorithmOptions = getAlgoOptions(material.algorithm.name, salt);\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/deriveKey#HKDF\n  // https://developer.mozilla.org/en-US/docs/Web/API/HkdfParams\n  const encryptionKey = await crypto.subtle.deriveKey(\n    algorithmOptions,\n    material,\n    {\n      name: ENCRYPTION_ALGORITHM,\n      length: 128,\n    },\n    false,\n    ['encrypt', 'decrypt'],\n  );\n\n  return { material, encryptionKey };\n}\n\nexport function createE2EEKey(): Uint8Array {\n  return window.crypto.getRandomValues(new Uint8Array(32));\n}\n\nexport function mimeTypeToVideoCodecString(mimeType: string) {\n  const codec = mimeType.split('/')[1].toLowerCase() as VideoCodec;\n  if (!videoCodecs.includes(codec)) {\n    throw Error(`Video codec not supported: ${codec}`);\n  }\n  return codec;\n}\n\n/**\n * Ratchets a key. See\n * https://tools.ietf.org/html/draft-omara-sframe-00#section-4.3.5.1\n */\nexport async function ratchet(material: CryptoKey, salt: string): Promise<ArrayBuffer> {\n  const algorithmOptions = getAlgoOptions(material.algorithm.name, salt);\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/deriveBits\n  return crypto.subtle.deriveBits(algorithmOptions, material, 256);\n}\n","/* eslint-disable @typescript-eslint/no-unused-vars */\n// TODO code inspired by https://github.com/webrtc/samples/blob/gh-pages/src/content/insertable-streams/endtoend-encryption/js/worker.js\n\nimport { EventEmitter } from 'events';\nimport type TypedEmitter from 'typed-emitter';\nimport { workerLogger } from '../../logger';\nimport type { VideoCodec } from '../../room/track/options';\nimport { ENCRYPTION_ALGORITHM, IV_LENGTH, UNENCRYPTED_BYTES } from '../constants';\nimport { E2EEError, E2EEErrorReason } from '../errors';\nimport {\n  CryptorCallbacks,\n  CryptorEvent,\n  DecodeRatchetOptions,\n  KeyProviderOptions,\n  KeySet,\n} from '../types';\nimport { deriveKeys, isVideoFrame } from '../utils';\nimport type { ParticipantKeyHandler } from './ParticipantKeyHandler';\n\nexport interface CryptorConstructor {\n  new (opts?: unknown): BaseCryptor;\n}\n\nexport interface TransformerInfo {\n  readable: ReadableStream;\n  writable: WritableStream;\n  transformer: TransformStream;\n  abortController: AbortController;\n}\n\nexport class BaseCryptor extends (EventEmitter as new () => TypedEmitter<CryptorCallbacks>) {\n  encodeFunction(\n    encodedFrame: RTCEncodedVideoFrame | RTCEncodedAudioFrame,\n    controller: TransformStreamDefaultController,\n  ): Promise<any> {\n    throw Error('not implemented for subclass');\n  }\n\n  decodeFunction(\n    encodedFrame: RTCEncodedVideoFrame | RTCEncodedAudioFrame,\n    controller: TransformStreamDefaultController,\n  ): Promise<any> {\n    throw Error('not implemented for subclass');\n  }\n}\n\n/**\n * Cryptor is responsible for en-/decrypting media frames.\n * Each Cryptor instance is responsible for en-/decrypting a single mediaStreamTrack.\n */\nexport class Cryptor extends BaseCryptor {\n  private sendCounts: Map<number, number>;\n\n  private isKeyInvalid = false;\n\n  private participantId: string | undefined;\n\n  private trackId: string | undefined;\n\n  private keys: ParticipantKeyHandler;\n\n  private videoCodec?: VideoCodec;\n\n  private rtpMap: Map<number, VideoCodec>;\n\n  private keyProviderOptions: KeyProviderOptions;\n\n  constructor(opts: {\n    // enabled?: boolean;\n    keys: ParticipantKeyHandler;\n    participantId: string;\n    keyProviderOptions: KeyProviderOptions;\n  }) {\n    super();\n    this.sendCounts = new Map();\n    this.keys = opts.keys;\n    this.participantId = opts.participantId;\n    this.rtpMap = new Map();\n    this.keyProviderOptions = opts.keyProviderOptions;\n  }\n\n  /**\n   * Assign a different participant to the cryptor.\n   * useful for transceiver re-use\n   * @param id\n   * @param keys\n   */\n  setParticipant(id: string, keys: ParticipantKeyHandler) {\n    this.participantId = id;\n    this.keys = keys;\n  }\n\n  unsetParticipant() {\n    this.participantId = undefined;\n  }\n\n  getParticipantId() {\n    return this.participantId;\n  }\n\n  getTrackId() {\n    return this.trackId;\n  }\n\n  /**\n   * Update the video codec used by the mediaStreamTrack\n   * @param codec\n   */\n  setVideoCodec(codec: VideoCodec) {\n    this.videoCodec = codec;\n  }\n\n  /**\n   * rtp payload type map used for figuring out codec of payload type when encoding\n   * @param map\n   */\n  setRtpMap(map: Map<number, VideoCodec>) {\n    this.rtpMap = map;\n  }\n\n  setupTransform(\n    operation: 'encode' | 'decode',\n    readable: ReadableStream,\n    writable: WritableStream,\n    trackId: string,\n    codec?: VideoCodec,\n  ) {\n    if (codec) {\n      console.info('setting codec on cryptor to', codec);\n      this.videoCodec = codec;\n    }\n    const transformFn = operation === 'encode' ? this.encodeFunction : this.decodeFunction;\n    const transformStream = new TransformStream({\n      transform: transformFn.bind(this),\n    });\n\n    readable\n      .pipeThrough(transformStream)\n      .pipeTo(writable)\n      .catch((e) => {\n        const errorMsg = {\n          kind: 'error',\n          data: {\n            reason: e.reason,\n            message: e.message,\n          },\n        };\n        postMessage(errorMsg);\n        workerLogger.error(e);\n      });\n    this.trackId = trackId;\n  }\n\n  /**\n   * Function that will be injected in a stream and will encrypt the given encoded frames.\n   *\n   * @param {RTCEncodedVideoFrame|RTCEncodedAudioFrame} encodedFrame - Encoded video frame.\n   * @param {TransformStreamDefaultController} controller - TransportStreamController.\n   *\n   * The VP8 payload descriptor described in\n   * https://tools.ietf.org/html/rfc7741#section-4.2\n   * is part of the RTP packet and not part of the frame and is not controllable by us.\n   * This is fine as the SFU keeps having access to it for routing.\n   *\n   * The encrypted frame is formed as follows:\n   * 1) Find unencrypted byte length, depending on the codec, frame type and kind.\n   * 2) Form the GCM IV for the frame as described above.\n   * 3) Encrypt the rest of the frame using AES-GCM.\n   * 4) Allocate space for the encrypted frame.\n   * 5) Copy the unencrypted bytes to the start of the encrypted frame.\n   * 6) Append the ciphertext to the encrypted frame.\n   * 7) Append the IV.\n   * 8) Append a single byte for the key identifier.\n   * 9) Enqueue the encrypted frame for sending.\n   */\n  async encodeFunction(\n    encodedFrame: RTCEncodedVideoFrame | RTCEncodedAudioFrame,\n    controller: TransformStreamDefaultController,\n  ) {\n    if (\n      !this.keys.isEnabled() ||\n      // skip for encryption for empty dtx frames\n      encodedFrame.data.byteLength === 0\n    ) {\n      return controller.enqueue(encodedFrame);\n    }\n\n    const { encryptionKey } = this.keys.getKeySet();\n    const keyIndex = this.keys.getCurrentKeyIndex();\n\n    if (encryptionKey) {\n      const iv = this.makeIV(\n        encodedFrame.getMetadata().synchronizationSource ?? -1,\n        encodedFrame.timestamp,\n      );\n\n      // Ths is not encrypted and contains the VP8 payload descriptor or the Opus TOC byte.\n      const frameHeader = new Uint8Array(\n        encodedFrame.data,\n        0,\n        this.getUnencryptedBytes(encodedFrame),\n      );\n\n      // Frame trailer contains the R|IV_LENGTH and key index\n      const frameTrailer = new Uint8Array(2);\n\n      frameTrailer[0] = IV_LENGTH;\n      frameTrailer[1] = keyIndex;\n\n      // Construct frame trailer. Similar to the frame header described in\n      // https://tools.ietf.org/html/draft-omara-sframe-00#section-4.2\n      // but we put it at the end.\n      //\n      // ---------+-------------------------+-+---------+----\n      // payload  |IV...(length = IV_LENGTH)|R|IV_LENGTH|KID |\n      // ---------+-------------------------+-+---------+----\n      try {\n        const cipherText = await crypto.subtle.encrypt(\n          {\n            name: ENCRYPTION_ALGORITHM,\n            iv,\n            additionalData: new Uint8Array(encodedFrame.data, 0, frameHeader.byteLength),\n          },\n          encryptionKey,\n          new Uint8Array(encodedFrame.data, this.getUnencryptedBytes(encodedFrame)),\n        );\n\n        const newData = new ArrayBuffer(\n          frameHeader.byteLength + cipherText.byteLength + iv.byteLength + frameTrailer.byteLength,\n        );\n        const newUint8 = new Uint8Array(newData);\n\n        newUint8.set(frameHeader); // copy first bytes.\n        newUint8.set(new Uint8Array(cipherText), frameHeader.byteLength); // add ciphertext.\n        newUint8.set(new Uint8Array(iv), frameHeader.byteLength + cipherText.byteLength); // append IV.\n        newUint8.set(frameTrailer, frameHeader.byteLength + cipherText.byteLength + iv.byteLength); // append frame trailer.\n\n        encodedFrame.data = newData;\n\n        return controller.enqueue(encodedFrame);\n      } catch (e: any) {\n        // TODO: surface this to the app.\n        workerLogger.error(e);\n      }\n    } else {\n      this.emit(\n        CryptorEvent.Error,\n        new E2EEError(`encryption key missing for encoding`, E2EEErrorReason.MissingKey),\n      );\n      // workerLogger.debug('skipping frame encryption');\n    }\n  }\n\n  /**\n   * Function that will be injected in a stream and will decrypt the given encoded frames.\n   *\n   * @param {RTCEncodedVideoFrame|RTCEncodedAudioFrame} encodedFrame - Encoded video frame.\n   * @param {TransformStreamDefaultController} controller - TransportStreamController.\n   */\n  async decodeFunction(\n    encodedFrame: RTCEncodedVideoFrame | RTCEncodedAudioFrame,\n    controller: TransformStreamDefaultController,\n  ) {\n    if (\n      !this.keys.isEnabled() ||\n      // skip for decryption for empty dtx frames\n      encodedFrame.data.byteLength === 0\n    ) {\n      return controller.enqueue(encodedFrame);\n    }\n    const data = new Uint8Array(encodedFrame.data);\n    const keyIndex = data[encodedFrame.data.byteLength - 1];\n\n    if (this.keys.getKeySet(keyIndex)) {\n      try {\n        const decodedFrame = await this.decryptFrame(encodedFrame, keyIndex);\n        if (decodedFrame) {\n          return controller.enqueue(decodedFrame);\n        }\n        this.isKeyInvalid = false;\n      } catch (error) {\n        if (error instanceof E2EEError && error.reason === E2EEErrorReason.InvalidKey) {\n          if (!this.isKeyInvalid) {\n            workerLogger.warn('invalid key');\n            this.emit(\n              CryptorEvent.Error,\n              new E2EEError(\n                `invalid key for participant ${this.participantId}`,\n                E2EEErrorReason.InvalidKey,\n              ),\n            );\n            this.isKeyInvalid = true;\n          }\n        } else {\n          workerLogger.warn('decoding frame failed', { error });\n        }\n      }\n    } else {\n      this.emit(\n        CryptorEvent.Error,\n        new E2EEError(\n          `key missing for participant ${this.participantId}`,\n          E2EEErrorReason.MissingKey,\n        ),\n      );\n    }\n\n    return controller.enqueue(encodedFrame);\n  }\n\n  /**\n   * Function that will decrypt the given encoded frame. If the decryption fails, it will\n   * ratchet the key for up to RATCHET_WINDOW_SIZE times.\n   */\n  async decryptFrame(\n    encodedFrame: RTCEncodedVideoFrame | RTCEncodedAudioFrame,\n    keyIndex: number,\n    initialMaterial: KeySet | undefined = undefined,\n    ratchetOpts: DecodeRatchetOptions = { ratchetCount: 0 },\n  ): Promise<RTCEncodedVideoFrame | RTCEncodedAudioFrame | undefined> {\n    const keySet = this.keys.getKeySet(keyIndex);\n\n    // Construct frame trailer. Similar to the frame header described in\n    // https://tools.ietf.org/html/draft-omara-sframe-00#section-4.2\n    // but we put it at the end.\n    //\n    // ---------+-------------------------+-+---------+----\n    // payload  |IV...(length = IV_LENGTH)|R|IV_LENGTH|KID |\n    // ---------+-------------------------+-+---------+----\n\n    try {\n      const frameHeader = new Uint8Array(\n        encodedFrame.data,\n        0,\n        this.getUnencryptedBytes(encodedFrame),\n      );\n      const frameTrailer = new Uint8Array(encodedFrame.data, encodedFrame.data.byteLength - 2, 2);\n\n      const ivLength = frameTrailer[0];\n      const iv = new Uint8Array(\n        encodedFrame.data,\n        encodedFrame.data.byteLength - ivLength - frameTrailer.byteLength,\n        ivLength,\n      );\n\n      const cipherTextStart = frameHeader.byteLength;\n      const cipherTextLength =\n        encodedFrame.data.byteLength -\n        (frameHeader.byteLength + ivLength + frameTrailer.byteLength);\n\n      const plainText = await crypto.subtle.decrypt(\n        {\n          name: ENCRYPTION_ALGORITHM,\n          iv,\n          additionalData: new Uint8Array(encodedFrame.data, 0, frameHeader.byteLength),\n        },\n        ratchetOpts.encryptionKey ?? keySet.encryptionKey,\n        new Uint8Array(encodedFrame.data, cipherTextStart, cipherTextLength),\n      );\n\n      const newData = new ArrayBuffer(frameHeader.byteLength + plainText.byteLength);\n      const newUint8 = new Uint8Array(newData);\n\n      newUint8.set(new Uint8Array(encodedFrame.data, 0, frameHeader.byteLength));\n      newUint8.set(new Uint8Array(plainText), frameHeader.byteLength);\n\n      encodedFrame.data = newData;\n\n      return encodedFrame;\n    } catch (error: any) {\n      workerLogger.error(error);\n      if (this.keyProviderOptions.ratchetWindowSize > 0) {\n        if (ratchetOpts.ratchetCount < this.keyProviderOptions.ratchetWindowSize) {\n          workerLogger.info(\n            `ratcheting key attempt ${ratchetOpts.ratchetCount} of ${\n              this.keyProviderOptions.ratchetWindowSize\n            }, for kind ${encodedFrame instanceof RTCEncodedAudioFrame ? 'audio' : 'video'}`,\n          );\n          if (encodedFrame instanceof RTCEncodedAudioFrame) {\n            console.log(encodedFrame.data);\n          }\n\n          let ratchetedKeySet: KeySet | undefined;\n          if (keySet === this.keys.getKeySet(keyIndex)) {\n            // only ratchet if the currently set key is still the same as the one used to decrypt this frame\n            // if not, it might be that a different frame has already ratcheted and we try with that one first\n            const newMaterial = await this.keys.ratchetKey(keyIndex, false);\n\n            ratchetedKeySet = await deriveKeys(newMaterial, this.keyProviderOptions.ratchetSalt);\n          }\n\n          const frame = await this.decryptFrame(encodedFrame, keyIndex, initialMaterial || keySet, {\n            ratchetCount: ratchetOpts.ratchetCount + 1,\n            encryptionKey: ratchetedKeySet?.encryptionKey,\n          });\n          if (frame && ratchetedKeySet) {\n            this.keys.setKeySet(ratchetedKeySet, keyIndex, true);\n            // decryption was successful, set the new key index to reflect the ratcheted key set\n            this.keys.setCurrentKeyIndex(keyIndex);\n          }\n          return frame;\n        } else {\n          /**\n           * Since the key it is first send and only afterwards actually used for encrypting, there were\n           * situations when the decrypting failed due to the fact that the received frame was not encrypted\n           * yet and ratcheting, of course, did not solve the problem. So if we fail RATCHET_WINDOW_SIZE times,\n           * we come back to the initial key.\n           */\n          if (initialMaterial) {\n            workerLogger.debug('resetting to initial material');\n            this.keys.setKeyFromMaterial(initialMaterial.material, keyIndex);\n          }\n\n          workerLogger.error('maximum ratchet attempts exceeded, resetting key');\n        }\n      } else {\n        throw new E2EEError('Got invalid key when trying to decode', E2EEErrorReason.InvalidKey);\n      }\n    }\n  }\n\n  /**\n   * Construct the IV used for AES-GCM and sent (in plain) with the packet similar to\n   * https://tools.ietf.org/html/rfc7714#section-8.1\n   * It concatenates\n   * - the 32 bit synchronization source (SSRC) given on the encoded frame,\n   * - the 32 bit rtp timestamp given on the encoded frame,\n   * - a send counter that is specific to the SSRC. Starts at a random number.\n   * The send counter is essentially the pictureId but we currently have to implement this ourselves.\n   * There is no XOR with a salt. Note that this IV leaks the SSRC to the receiver but since this is\n   * randomly generated and SFUs may not rewrite this is considered acceptable.\n   * The SSRC is used to allow demultiplexing multiple streams with the same key, as described in\n   *   https://tools.ietf.org/html/rfc3711#section-4.1.1\n   * The RTP timestamp is 32 bits and advances by the codec clock rate (90khz for video, 48khz for\n   * opus audio) every second. For video it rolls over roughly every 13 hours.\n   * The send counter will advance at the frame rate (30fps for video, 50fps for 20ms opus audio)\n   * every second. It will take a long time to roll over.\n   *\n   * See also https://developer.mozilla.org/en-US/docs/Web/API/AesGcmParams\n   */\n  private makeIV(synchronizationSource: number, timestamp: number) {\n    const iv = new ArrayBuffer(IV_LENGTH);\n    const ivView = new DataView(iv);\n\n    // having to keep our own send count (similar to a picture id) is not ideal.\n    if (!this.sendCounts.has(synchronizationSource)) {\n      // Initialize with a random offset, similar to the RTP sequence number.\n      this.sendCounts.set(synchronizationSource, Math.floor(Math.random() * 0xffff));\n    }\n\n    const sendCount = this.sendCounts.get(synchronizationSource) ?? 0;\n\n    ivView.setUint32(0, synchronizationSource);\n    ivView.setUint32(4, timestamp);\n    ivView.setUint32(8, timestamp - (sendCount % 0xffff));\n\n    this.sendCounts.set(synchronizationSource, sendCount + 1);\n\n    return iv;\n  }\n\n  getUnencryptedBytes(frame: RTCEncodedVideoFrame | RTCEncodedAudioFrame): number {\n    if (isVideoFrame(frame)) {\n      let detectedCodec = this.getVideoCodec(frame) ?? this.videoCodec;\n\n      if (detectedCodec === 'av1') {\n        throw new Error('AV1 is not yet supported for end to end encryption');\n      }\n\n      if (detectedCodec === 'vp8') {\n        return UNENCRYPTED_BYTES[frame.type];\n      }\n\n      const data = new Uint8Array(frame.data);\n      const naluIndices = findNALUIndices(data);\n\n      // if the detected codec is undefined we test whether it _looks_ like a h264 frame as a best guess\n      const isH264 =\n        detectedCodec === 'h264' ||\n        naluIndices.some((naluIndex) =>\n          [NALUType.SLICE_IDR, NALUType.SLICE_NON_IDR].includes(parseNALUType(data[naluIndex])),\n        );\n\n      if (isH264) {\n        for (const index of naluIndices) {\n          let type = parseNALUType(data[index]);\n          switch (type) {\n            case NALUType.SLICE_IDR:\n            case NALUType.SLICE_NON_IDR:\n              return index + 2;\n            default:\n              break;\n          }\n        }\n        throw new E2EEError('Could not find NALU');\n      } else {\n        // we could not detect the video codec, so default back to treat it as vp8\n        return UNENCRYPTED_BYTES[frame.type];\n      }\n    } else {\n      return UNENCRYPTED_BYTES.audio;\n    }\n  }\n\n  /**\n   * inspects frame payloadtype if available and maps it to the codec specified in rtpMap\n   */\n  getVideoCodec(frame: RTCEncodedVideoFrame): VideoCodec | undefined {\n    if (this.rtpMap.size === 0) {\n      return undefined;\n    }\n    // @ts-expect-error payloadType is not yet part of the typescript definition and currently not supported in Safari\n    const payloadType = frame.getMetadata().payloadType;\n    const codec = payloadType ? this.rtpMap.get(payloadType) : undefined;\n    return codec;\n  }\n}\n\n/**\n * Slice the NALUs present in the supplied buffer, assuming it is already byte-aligned\n * code adapted from https://github.com/medooze/h264-frame-parser/blob/main/lib/NalUnits.ts to return indices only\n */\nexport function findNALUIndices(stream: Uint8Array): number[] {\n  const result: number[] = [];\n  let start = 0,\n    pos = 0,\n    searchLength = stream.length - 2;\n  while (pos < searchLength) {\n    // skip until end of current NALU\n    while (\n      pos < searchLength &&\n      !(stream[pos] === 0 && stream[pos + 1] === 0 && stream[pos + 2] === 1)\n    )\n      pos++;\n    if (pos >= searchLength) pos = stream.length;\n    // remove trailing zeros from current NALU\n    let end = pos;\n    while (end > start && stream[end - 1] === 0) end--;\n    // save current NALU\n    if (start === 0) {\n      if (end !== start) throw TypeError('byte stream contains leading data');\n    } else {\n      result.push(start);\n    }\n    // begin new NALU\n    start = pos = pos + 3;\n  }\n  return result;\n}\n\nexport function parseNALUType(startByte: number): NALUType {\n  return startByte & kNaluTypeMask;\n}\n\nconst kNaluTypeMask = 0x1f;\n\nexport enum NALUType {\n  /** Coded slice of a non-IDR picture */\n  SLICE_NON_IDR = 1,\n  /** Coded slice data partition A */\n  SLICE_PARTITION_A = 2,\n  /** Coded slice data partition B */\n  SLICE_PARTITION_B = 3,\n  /** Coded slice data partition C */\n  SLICE_PARTITION_C = 4,\n  /** Coded slice of an IDR picture */\n  SLICE_IDR = 5,\n  /** Supplemental enhancement information */\n  SEI = 6,\n  /** Sequence parameter set */\n  SPS = 7,\n  /** Picture parameter set */\n  PPS = 8,\n  /** Access unit delimiter */\n  AUD = 9,\n  /** End of sequence */\n  END_SEQ = 10,\n  /** End of stream */\n  END_STREAM = 11,\n  /** Filler data */\n  FILLER_DATA = 12,\n  /** Sequence parameter set extension */\n  SPS_EXT = 13,\n  /** Prefix NAL unit */\n  PREFIX_NALU = 14,\n  /** Subset sequence parameter set */\n  SUBSET_SPS = 15,\n  /** Depth parameter set */\n  DPS = 16,\n\n  // 17, 18 reserved\n\n  /** Coded slice of an auxiliary coded picture without partitioning */\n  SLICE_AUX = 19,\n  /** Coded slice extension */\n  SLICE_EXT = 20,\n  /** Coded slice extension for a depth view component or a 3D-AVC texture view component */\n  SLICE_LAYER_EXT = 21,\n\n  // 22, 23 reserved\n}\n","import { Cryptor } from './Cryptor';\nimport type {\n  E2EEWorkerMessage,\n  EnableMessage,\n  KeyProviderOptions,\n  RatchetMessage,\n} from '../types';\nimport { setLogLevel, workerLogger } from '../../logger';\nimport { KEY_PROVIDER_DEFAULTS } from '../constants';\nimport { ParticipantKeyHandler } from './ParticipantKeyHandler';\n\nconst participantCryptors: Cryptor[] = [];\nconst participantKeys: Map<string, ParticipantKeyHandler> = new Map();\n\nlet publishCryptors: Cryptor[] = [];\nlet publisherKeys: ParticipantKeyHandler;\n\nlet isEncryptionEnabled: boolean = false;\n\nlet useSharedKey: boolean = false;\n\nlet sharedKey: CryptoKey | undefined;\n\nlet keyProviderOptions: KeyProviderOptions = KEY_PROVIDER_DEFAULTS;\n\nsetLogLevel('debug', 'lk-e2ee');\n\n/**\n * @param ev{string}\n */\nonmessage = (ev) => {\n  const { kind, data }: E2EEWorkerMessage = ev.data;\n\n  switch (kind) {\n    case 'init':\n      workerLogger.info('worker initialized');\n      keyProviderOptions = data.keyProviderOptions;\n      useSharedKey = !!data.keyProviderOptions.sharedKey;\n      // acknowledge init successful\n      const enableMsg: EnableMessage = {\n        kind: 'enable',\n        data: { enabled: isEncryptionEnabled },\n      };\n      publisherKeys = new ParticipantKeyHandler(undefined, isEncryptionEnabled, keyProviderOptions);\n      publisherKeys.on('keyRatcheted', emitRatchetedKeys);\n      postMessage(enableMsg);\n      break;\n    case 'enable':\n      setEncryptionEnabled(data.enabled, data.participantId);\n      workerLogger.info('updated e2ee enabled status');\n      // acknowledge enable call successful\n      postMessage(ev.data);\n      break;\n    case 'decode':\n      let cryptor = getTrackCryptor(data.participantId, data.trackId);\n      cryptor.setupTransform(\n        kind,\n        data.readableStream,\n        data.writableStream,\n        data.trackId,\n        data.codec,\n      );\n      break;\n    case 'encode':\n      let pubCryptor = getPublisherCryptor(data.trackId);\n      pubCryptor.setupTransform(\n        kind,\n        data.readableStream,\n        data.writableStream,\n        data.trackId,\n        data.codec,\n      );\n      break;\n    case 'setKey':\n      if (useSharedKey) {\n        workerLogger.debug('set shared key');\n        setSharedKey(data.key, data.keyIndex);\n      } else if (data.participantId) {\n        getParticipantKeyHandler(data.participantId).setKeyFromMaterial(data.key, data.keyIndex);\n      } else {\n        workerLogger.error('no participant Id was provided and shared key usage is disabled');\n      }\n      break;\n    case 'removeTransform':\n      unsetCryptorParticipant(data.trackId);\n      break;\n    case 'updateCodec':\n      getTrackCryptor(data.participantId, data.trackId).setVideoCodec(data.codec);\n      break;\n    case 'setRTPMap':\n      publishCryptors.forEach((cr) => {\n        cr.setRtpMap(data.map);\n      });\n      break;\n    case 'ratchetRequest':\n      getParticipantKeyHandler(data.participantId).ratchetKey(data.keyIndex);\n\n    default:\n      break;\n  }\n};\n\nfunction getTrackCryptor(participantId: string, trackId: string) {\n  let cryptor = participantCryptors.find((c) => c.getTrackId() === trackId);\n  if (!cryptor) {\n    workerLogger.info('creating new cryptor for', { participantId });\n    if (!keyProviderOptions) {\n      throw Error('Missing keyProvider options');\n    }\n    cryptor = new Cryptor({\n      participantId,\n      keys: getParticipantKeyHandler(participantId),\n      keyProviderOptions,\n    });\n\n    setupCryptorErrorEvents(cryptor);\n    participantCryptors.push(cryptor);\n  } else if (participantId !== cryptor.getParticipantId()) {\n    // assign new participant id to track cryptor and pass in correct key handler\n    cryptor.setParticipant(participantId, getParticipantKeyHandler(participantId));\n  }\n  if (sharedKey) {\n  }\n  return cryptor;\n}\n\nfunction getParticipantKeyHandler(participantId?: string) {\n  if (!participantId) {\n    return publisherKeys!;\n  }\n  let keys = participantKeys.get(participantId);\n  if (!keys) {\n    keys = new ParticipantKeyHandler(participantId, true, keyProviderOptions);\n    if (sharedKey) {\n      keys.setKeyFromMaterial(sharedKey);\n    }\n    participantKeys.set(participantId, keys);\n  }\n  return keys;\n}\n\nfunction unsetCryptorParticipant(trackId: string) {\n  participantCryptors.find((c) => c.getTrackId() === trackId)?.unsetParticipant();\n}\n\nfunction getPublisherCryptor(trackId: string) {\n  let publishCryptor = publishCryptors.find((cryptor) => cryptor.getTrackId() === trackId);\n  if (!publishCryptor) {\n    if (!keyProviderOptions) {\n      throw Error('Missing keyProvider options');\n    }\n    publishCryptor = new Cryptor({\n      keys: publisherKeys!,\n      participantId: 'publisher',\n      keyProviderOptions,\n    });\n    setupCryptorErrorEvents(publishCryptor);\n    publishCryptors.push(publishCryptor);\n  }\n  return publishCryptor;\n}\n\nfunction setEncryptionEnabled(enable: boolean, participantId?: string) {\n  if (!participantId) {\n    isEncryptionEnabled = enable;\n    publisherKeys.setEnabled(enable);\n  } else {\n    getParticipantKeyHandler(participantId).setEnabled(enable);\n  }\n}\n\nfunction setSharedKey(key: CryptoKey, index?: number) {\n  workerLogger.debug('setting shared key');\n  sharedKey = key;\n  publisherKeys?.setKeyFromMaterial(key, index);\n  for (const [, keyHandler] of participantKeys) {\n    keyHandler.setKeyFromMaterial(key, index);\n  }\n}\n\nfunction emitRatchetedKeys(material: CryptoKey, keyIndex?: number) {\n  const msg: RatchetMessage = {\n    kind: `ratchetKey`,\n    data: {\n      // participantId,\n      keyIndex,\n      material,\n    },\n  };\n  postMessage(msg);\n}\n\n// Operations using RTCRtpScriptTransform.\n// @ts-ignore\nif (self.RTCTransformEvent) {\n  workerLogger.debug('setup transform event');\n  // @ts-ignore\n  self.onrtctransform = (event) => {\n    const transformer = event.transformer;\n    workerLogger.debug('transformer', transformer);\n    transformer.handled = true;\n    const { kind, participantId, trackId, codec } = transformer.options;\n    const cryptor =\n      kind === 'encode' ? getPublisherCryptor(trackId) : getTrackCryptor(participantId, trackId);\n    workerLogger.debug('transform', { codec });\n    cryptor.setupTransform(kind, transformer.readable, transformer.writable, trackId, codec);\n  };\n}\n\nfunction setupCryptorErrorEvents(cryptor: Cryptor) {\n  cryptor.on('cryptorError', (error) => {\n    const msg = {\n      kind: 'error',\n      data: { reason: error.reason, message: error.message },\n    };\n    postMessage(msg);\n  });\n}\n","import EventEmitter from 'events';\nimport type TypedEmitter from 'typed-emitter';\nimport { workerLogger } from '../../logger';\nimport { KEYRING_SIZE } from '../constants';\nimport type { KeySet, KeyProviderOptions, ParticipantKeyHandlerCallbacks } from '../types';\nimport { importKey, ratchet, deriveKeys } from '../utils';\n\n// TODO ParticipantKeyHandlers currently don't get destroyed on participant disconnect\n// we could do this by having a separate worker message on participant disconnected.\n\n/**\n * ParticipantKeyHandler is responsible for providing a cryptor instance with the\n * en-/decryption key of a participant. It assumes that all tracks of a specific participant\n * are encrypted with the same key.\n * Additionally it exposes a method to ratchet a key which can be used by the cryptor either automatically\n * if decryption fails or can be triggered manually on both sender and receiver side.\n *\n */\nexport class ParticipantKeyHandler extends (EventEmitter as new () => TypedEmitter<ParticipantKeyHandlerCallbacks>) {\n  private currentKeyIndex: number;\n\n  private cryptoKeyRing: Array<KeySet>;\n\n  private enabled: boolean;\n\n  private keyProviderOptions: KeyProviderOptions;\n\n  private ratchetPromiseMap: Map<number, Promise<CryptoKey>>;\n\n  private participantId: string | undefined;\n\n  constructor(\n    participantId: string | undefined,\n    isEnabled: boolean,\n    keyProviderOptions: KeyProviderOptions,\n  ) {\n    super();\n    this.currentKeyIndex = 0;\n    this.cryptoKeyRing = new Array(KEYRING_SIZE);\n    this.enabled = isEnabled;\n    this.keyProviderOptions = keyProviderOptions;\n    this.ratchetPromiseMap = new Map();\n    this.participantId = participantId;\n  }\n\n  setEnabled(enabled: boolean) {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Ratchets the current key (or the one at keyIndex if provided) and\n   * returns the ratcheted material\n   * if `setKey` is true (default), it will also set the ratcheted key directly on the crypto key ring\n   * @param keyIndex\n   * @param setKey\n   */\n  ratchetKey(keyIndex?: number, setKey = true): Promise<CryptoKey> {\n    const currentKeyIndex = (keyIndex ??= this.getCurrentKeyIndex());\n\n    const existingPromise = this.ratchetPromiseMap.get(currentKeyIndex);\n    if (typeof existingPromise !== 'undefined') {\n      return existingPromise;\n    }\n    const ratchetPromise = new Promise<CryptoKey>(async (resolve, reject) => {\n      try {\n        const currentMaterial = this.getKeySet(currentKeyIndex).material;\n        const newMaterial = await importKey(\n          await ratchet(currentMaterial, this.keyProviderOptions.ratchetSalt),\n          currentMaterial.algorithm.name,\n          'derive',\n        );\n\n        if (setKey) {\n          this.setKeyFromMaterial(newMaterial, currentKeyIndex, true);\n        }\n        this.emit('keyRatcheted', newMaterial, keyIndex, this.participantId);\n        resolve(newMaterial);\n      } catch (e) {\n        reject(e);\n      } finally {\n        this.ratchetPromiseMap.delete(currentKeyIndex);\n      }\n    });\n    this.ratchetPromiseMap.set(currentKeyIndex, ratchetPromise);\n    return ratchetPromise;\n  }\n\n  /**\n   * takes in a key material with `deriveBits` and `deriveKey` set as key usages\n   * and derives encryption keys from the material and sets it on the key ring buffer\n   * together with the material\n   * also updates the currentKeyIndex\n   */\n  async setKeyFromMaterial(material: CryptoKey, keyIndex = 0, emitRatchetEvent = false) {\n    workerLogger.debug('setting new key');\n    if (keyIndex >= 0) {\n      this.currentKeyIndex = keyIndex % this.cryptoKeyRing.length;\n    }\n    const keySet = await deriveKeys(material, this.keyProviderOptions.ratchetSalt);\n    this.setKeySet(keySet, this.currentKeyIndex, emitRatchetEvent);\n  }\n\n  async setKeySet(keySet: KeySet, keyIndex: number, emitRatchetEvent = false) {\n    this.cryptoKeyRing[keyIndex % this.cryptoKeyRing.length] = keySet;\n    if (emitRatchetEvent) {\n      this.emit('keyRatcheted', keySet.material, keyIndex, this.participantId);\n    }\n  }\n\n  async setCurrentKeyIndex(index: number) {\n    this.currentKeyIndex = index % this.cryptoKeyRing.length;\n  }\n\n  isEnabled() {\n    return this.enabled;\n  }\n\n  getCurrentKeyIndex() {\n    return this.currentKeyIndex;\n  }\n\n  /**\n   * returns currently used KeySet or the one at `keyIndex` if provided\n   * @param keyIndex\n   * @returns\n   */\n  getKeySet(keyIndex?: number) {\n    return this.cryptoKeyRing[keyIndex ?? this.currentKeyIndex];\n  }\n}\n"],"names":["_arrayLikeToArray","arr","len","length","i","arr2","Array","_unsupportedIterableToArray","o","minLen","n","Object","prototype","toString","call","slice","constructor","name","from","test","_slicedToArray","isArray","_i","Symbol","iterator","_s","_e","_arr","_n","_d","next","done","push","value","err","TypeError","_createForOfIteratorHelper","allowArrayLike","it","F","s","e","f","normalCompletion","didErr","step","_e2","_typeof","obj","_regeneratorRuntime","exports","Op","hasOwn","hasOwnProperty","$Symbol","iteratorSymbol","asyncIteratorSymbol","asyncIterator","toStringTagSymbol","toStringTag","define","key","defineProperty","enumerable","configurable","writable","wrap","innerFn","outerFn","self","tryLocsList","protoGenerator","Generator","generator","create","context","Context","_invoke","state","method","arg","Error","doneResult","delegate","delegateResult","maybeInvokeDelegate","ContinueSentinel","sent","_sent","dispatchException","abrupt","record","tryCatch","type","fn","GeneratorFunction","GeneratorFunctionPrototype","IteratorPrototype","this","getProto","getPrototypeOf","NativeIteratorPrototype","values","Gp","defineIteratorMethods","forEach","AsyncIterator","PromiseImpl","invoke","resolve","reject","result","__await","then","unwrapped","error","previousPromise","callInvokeWithMethodAndArg","undefined","info","resultName","nextLoc","pushTryEntry","locs","entry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","iterable","iteratorMethod","isNaN","displayName","isGeneratorFunction","genFun","ctor","mark","setPrototypeOf","__proto__","awrap","async","Promise","iter","keys","object","reverse","pop","skipTempReset","prev","charAt","stop","rootRecord","rval","exception","handle","loc","caught","hasCatch","hasFinally","finallyEntry","complete","finish","thrown","delegateYield","asyncGeneratorStep","gen","_next","_throw","_asyncToGenerator","args","arguments","apply","_defineProperties","target","props","descriptor","_createClass","Constructor","protoProps","staticProps","_classCallCheck","instance","_setPrototypeOf","p","bind","_inherits","subClass","superClass","_getPrototypeOf","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","_possibleConstructorReturn","ReferenceError","_createSuper","Derived","hasNativeReflectConstruct","Super","NewTarget","_construct","Parent","Class","a","Function","_wrapNativeSuper","_cache","Map","indexOf","has","get","set","Wrapper","ReflectOwnKeys","R","ReflectApply","receiver","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","EventEmitter","init","eventsModule","events","emitter","errorListener","removeListener","resolver","eventTargetAgnosticAddListener","once","handler","flags","on","addErrorHandlerIfEventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","_getMaxListeners","that","_addListener","prepend","m","existing","warning","newListener","emit","unshift","warned","w","String","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","wrapped","_listeners","unwrap","evlistener","ret","unwrapListeners","arrayClone","listenerCount","copy","addEventListener","wrapListener","removeEventListener","RangeError","setMaxListeners","getMaxListeners","doError","er","message","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","index","spliceOne","off","removeAllListeners","rawListeners","eventNames","LogLevel","root","definition","noop","undefinedType","isIE","window","navigator","userAgent","logMethods","bindMethod","methodName","traceForIE","log","trace","realMethod","replaceLoggingMethods","level","loggerName","methodFactory","debug","enableLoggingWhenConsoleArrives","defaultMethodFactory","Logger","defaultLevel","factory","currentLevel","storageKey","getPersistedLevel","storedLevel","localStorage","ignore","cookie","document","location","encodeURIComponent","exec","levels","getLevel","setLevel","persist","toUpperCase","SILENT","levelNum","levelName","persistLevelIfPossible","setDefaultLevel","resetLevel","removeItem","clearPersistedLevel","enableAll","TRACE","disableAll","initialLevel","defaultLogger","_loggersByName","getLogger","logger","_log","noConflict","getLoggers","module","MediaDeviceFailure","workerLogger","ENCRYPTION_ALGORITHM","UNENCRYPTED_BYTES","delta","audio","empty","KEY_PROVIDER_DEFAULTS","sharedKey","ratchetSalt","ratchetWindowSize","LivekitError","code","NotFound","PermissionDenied","DeviceInUse","Other","AudioPresets","E2EEError","reason","CryptorEvent","importKey","keyBytes","algorithm","usage","crypto","subtle","getAlgoOptions","algorithmName","salt","encodedSalt","TextEncoder","encode","hash","ArrayBuffer","iterations","deriveKeys","material","algorithmOptions","deriveKey","encryptionKey","ratchet","deriveBits","maxBitrate","BaseCryptor","encodeFunction","encodedFrame","controller","decodeFunction","Cryptor","opts","isKeyInvalid","sendCounts","participantId","rtpMap","keyProviderOptions","setParticipant","id","unsetParticipant","getParticipantId","getTrackId","trackId","setVideoCodec","codec","videoCodec","setRtpMap","map","setupTransform","operation","readable","transformFn","transformStream","TransformStream","transform","pipeThrough","pipeTo","catch","errorMsg","kind","data","postMessage","isEnabled","byteLength","enqueue","getKeySet","keyIndex","getCurrentKeyIndex","iv","makeIV","getMetadata","synchronizationSource","_a","timestamp","frameHeader","Uint8Array","getUnencryptedBytes","frameTrailer","encrypt","additionalData","cipherText","newData","newUint8","decryptFrame","decodedFrame","initialMaterial","ratchetOpts","ratchetCount","keySet","ivLength","cipherTextStart","cipherTextLength","decrypt","plainText","RTCEncodedAudioFrame","ratchetKey","newMaterial","ratchetedKeySet","frame","setKeySet","setCurrentKeyIndex","setKeyFromMaterial","ivView","DataView","Math","floor","random","sendCount","setUint32","isVideoFrame","detectedCodec","getVideoCodec","naluIndices","stream","start","pos","searchLength","end","findNALUIndices","some","naluIndex","NALUType","SLICE_IDR","SLICE_NON_IDR","includes","parseNALUType","size","payloadType","startByte","kNaluTypeMask","publisherKeys","ParticipantKeyHandler","currentKeyIndex","cryptoKeyRing","enabled","ratchetPromiseMap","setEnabled","setKey","existingPromise","ratchetPromise","currentMaterial","delete","emitRatchetEvent","participantCryptors","participantKeys","publishCryptors","isEncryptionEnabled","useSharedKey","getTrackCryptor","cryptor","find","c","getParticipantKeyHandler","setupCryptorErrorEvents","getPublisherCryptor","publishCryptor","emitRatchetedKeys","msg","setLogLevel","onmessage","ev","enable","enableMsg","readableStream","writableStream","setSharedKey","unsetCryptorParticipant","cr","RTCTransformEvent","onrtctransform","event","transformer","handled","options"],"sourceRoot":""}